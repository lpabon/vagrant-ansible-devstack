---
- hosts: devstack
  gather_facts: False
  vars:
    devstack_repo: http://git.oschina.net/openstack-dev/devstack.git
    branch: stable/grizzly
    offline: no
    reclone: no
    git_base: http://git.oschina.net
    image_url: http://download.cirros-cloud.net/0.3.1/cirros-0.3.1-x86_64-uec.tar.gz
    devstack_branch: "{{branch}}"
  tasks:
    - name: git
      apt: pkg=git state=present

    - name: checkout devstack
      sudo: no
      git: repo={{devstack_repo}} dest=/home/vagrant/devstack version={{devstack_branch}}

    - name: copy localrc
      sudo: no
      template: src=localrc.basic dest=/home/vagrant/devstack/localrc

    # - name: do what you like
    #   sudo: yes
    #  script: dowhatyoulike.sh

    - name: stack.sh
      sudo: no
      shell: /home/vagrant/devstack/stack.sh 2>&1 > /tmp/stack.sh.log
